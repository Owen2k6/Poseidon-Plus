name: Maven build

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Java 1.8 (Temurin)
        uses: actions/setup-java@v4
        with:
          distribution: 'temurin'
          java-version: '8'        # use '8' rather than '1.8'
          cache: 'maven'

        # If you ever need to pin an exact Temurin build, use a value like:
        # java-version: '8.0.472+8'

      - name: Show java & maven info
        run: |
          java -version
          mvn -version

      - name: Install system-scoped jars (if present)
        run: |
          if [ -f libs/ModLoaderMP.jar ]; then
            echo "Installing libs/ModLoaderMP.jar into local Maven repo..."
            mvn -B org.apache.maven.plugins:maven-install-plugin:3.0.0-M1:install-file \
              -Dfile=libs/ModLoaderMP.jar \
              -DgroupId=modloader \
              -DartifactId=ModLoaderMP-B1.7.3 \
              -Dversion=1.0 \
              -Dpackaging=jar
          else
            echo "No libs/ModLoaderMP.jar found â€” continuing. If your build requires it, add it to libs/ or change the POM to use a proper repository."
          fi

      - name: Build with Maven (clean package)
        run: mvn -B -U -e clean package

      - name: Upload build artifact (jar)
        if: success()
        uses: actions/upload-artifact@v4
        with:
          name: poseidon-plus-jar
          path: target/*.jar
